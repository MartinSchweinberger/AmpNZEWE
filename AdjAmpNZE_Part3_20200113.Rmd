---
title: "A corpus-based analysis of adjective amplification in New Zealand English - Part 3"
author: "Anonymous"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---

This document shows an analysis that was performed with the aim of investigating ongoing changes in the adjective ampplifier system of New Zealand English (NZE) and to determine how innovative variants come to dominate the NZE amplifier system based on the Wellington Spoken Corpus (WSC). The following represents part 3 of this analysis.

In a first step, we prepare the session by cleaning the workspace, loading packages, setting options, and defining paths.

```{r adjampnze_3_01, echo=T, eval = T, message=FALSE, warning=FALSE}
# remove all lists from the current workspace
rm(list=ls(all=T))
# load libraries
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
# set options
options(stringsAsFactors = F)
options(scipen = 999)
options(max.print=10000)
# define image directory
imageDirectory<-"images"
```

Next, we load the data, remove superfluous columns, and inspect the adjectives.

```{r adjampnze_3_02, echo=T, eval = T, message=FALSE, warning=FALSE}
# load data
reallywsc <- read.delim("datatables/ampwsc_regdat.txt", sep = "\t", header = T, skipNul = T)
# create a really dep. variable
reallywsc <- reallywsc %>%
  dplyr::select(-ID, - FileSpeaker, -Speaker, -File)
# simplify adjective
table(reallywsc$Adjective)[order(table(reallywsc$Adjective), decreasing = T)]
```

Next, we simplify the adjectives by collapsing infrequent types and inspect the new data.

```{r adjampnze_3_03, echo=T, eval = T, message=FALSE, warning=FALSE}
freqadj <- names(table(reallywsc$Adjective))[which(table(reallywsc$Adjective) > 20)]
#reallywsc$Adjective <- ifelse(reallywsc$Adjective %in% freqadj, reallywsc$Adjective, "other")
# factorize variables 
fctr <- c("Adjective", "Ethnicity", "Gender", "Education", "L1", "Age", 
          "Function", "Priming", "SemanticCategory", "Emotionality", "really")
reallywsc[fctr] <- lapply(reallywsc[fctr], factor)
# inspect data
str(reallywsc)
```

Next, we inspect Frequency.

```{r adjampnze_3_04, echo=T, eval = T, message=FALSE, warning=FALSE}
# frequency
summary(reallywsc$Frequency)
```

Now, we scale Frequency and inspect it again.

```{r adjampnze_3_05, echo=T, eval = T, message=FALSE, warning=FALSE}
reallywsc$Frequency <- as.vector(scale(reallywsc$Frequency))
summary(reallywsc$Frequency)
```

Next, we plot Frequency.

```{r adjampnze_3_06, echo=T, eval = T, message=FALSE, warning=FALSE}
plot(reallywsc$Frequency, reallywsc$really)
abline(lm(reallywsc$really ~reallywsc$Frequency))
```

Next, we scale Gradability. We begin by inspecting it.

```{r adjampnze_3_07, echo=T, eval = T, message=FALSE, warning=FALSE}
# gradability
reallywsc$Gradability <- as.vector(scale(reallywsc$Gradability-1))
summary(reallywsc$Gradability)
```

Next, we scale Gradability. We begin by inspecting it.

```{r adjampnze_3_08, echo=T, eval = T, message=FALSE, warning=FALSE}
plot(reallywsc$Gradability, reallywsc$really)
abline(lm(reallywsc$really ~ reallywsc$Gradability))
```

Next, we perform the Boruta analysis and begin by using only the variables that we feed to the Boruta analysis, save the data, and start a first Boruta run.

```{r adjampnze_3_09, echo=T, eval = T, message=FALSE, warning=FALSE}
# load library
library(Boruta)
# create dada for boruta
borutadata <- reallywsc %>%
  na.omit()
# save and load data
write.table(borutadata, "datatables/borutadata.txt", sep = "\t", 
            col.names = T, row.names = F, quote = F)
# run 1
boruta.reallywsc <- Boruta(really ~.,data=borutadata)
print(boruta.reallywsc)
```

Next, we extract the confirmed Boruta formula to see which variables are deemed important.

```{r adjampnze_3_10, echo=T, eval = T, message=FALSE, warning=FALSE}
getConfirmedFormula(boruta.reallywsc)
```

Next, we plot the results of the first Boruta run.

```{r adjampnze_3_11, echo=T, eval = T, message=FALSE, warning=FALSE}
png("images/BorutaVeryWsc.png",  width = 1800, height = 300)
plot(boruta.reallywsc, cex = .75)
dev.off()
plot(boruta.reallywsc)
```

Next, we plot the history of the first Boruta run.

```{r adjampnze_3_12, echo=T, eval = T, message=FALSE, warning=FALSE}
png("images/BorutaVeryWsc_History1.png",  width = 680, height = 480)
plotImpHistory(boruta.reallywsc)
dev.off()
plotImpHistory(boruta.reallywsc)
```

Next, we remove those variables that are deemed unimportant by the first Boruta run and proceed with a second run.

```{r adjampnze_3_13, echo=T, eval = T, message=FALSE, warning=FALSE}
# remove superfluous variables
borutadata$Gradability <- NULL
borutadata$Function <- NULL
borutadata$Education <- NULL
borutadata$L1 <- NULL
# run2
boruta.reallywsc <- Boruta(really~.,data=borutadata)
print(boruta.reallywsc)
```

Next, we retreive the variables deemed important by the Boruta analysis by retrieving the forumla.

```{r adjampnze_3_14, echo=T, eval = T, message=FALSE, warning=FALSE}

getConfirmedFormula(boruta.reallywsc)
```

Next, we plot the reslts of the second Boruta run.

```{r adjampnze_3_15, echo=T, eval = T, message=FALSE, warning=FALSE}
png("images/BorutaVeryWsc2.png",  width = 1200, height = 300)
plot(boruta.reallywsc, cex = .75)
dev.off()
plot(boruta.reallywsc)
```

Next, we plot the history of the second Boruta run.

```{r adjampnze_3_16, echo=T, eval = T, message=FALSE, warning=FALSE}
png("images/BorutaNSP_History2.png",  width = 680, height = 480)
plotImpHistory(boruta.reallywsc)
dev.off()
plotImpHistory(boruta.reallywsc)
```

Next, we plot a publishable version of the Boruta results.

```{r adjampnze_3_17, echo=T, eval = T, message=FALSE, warning=FALSE}
png("images/BorutaVeryWsc_final.png",  width = 1500, height = 750)
par(mar = c(22, 8, 4, 2) + 0.1)
plot(boruta.reallywsc, cex.axis=3, las=2, xlab="", ylab = "", cex = 3, 
     col = c(rep("grey50", 8), rep("grey90",3)))
abline(v = 3.5, lty = "dashed")
mtext("Predictors", 1, line = 21, at = 9, cex = 3)
mtext("Control", 1, line = 21, at = 2, cex = 3)
mtext("Importance", 2, line = 5, at = 25, cex = 3, las = 0)
dev.off()
plot(boruta.reallywsc, cex.axis=3, las=2, xlab="", ylab = "", cex = 3, 
     col = c(rep("grey50", 8), rep("grey90",3)))
abline(v = 3.5, lty = "dashed")
mtext("Predictors", 1, line = 21, at = 9, cex = 3)
mtext("Control", 1, line = 21, at = 2, cex = 3)
mtext("Importance", 2, line = 5, at = 25, cex = 3, las = 0)
par(mar = c(5, 4, 4, 2) + 0.1)
```

Now, we start with the regression modelling and begin by loading the packages, setting options for contarsts, and creating fixed-effects base-line models.

```{r adjampnze_3_18, echo=T, eval = T, message=FALSE, warning=FALSE}
# load library
library(rms)
# set options
options(contrasts  =c("contr.treatment", "contr.poly"))
reallywsc.dist <- datadist(reallywsc)
options(datadist = "reallywsc.dist")
# generate initial minimal regression model 
m0.glm = glm(really ~ 1, family = binomial, data = reallywsc) # baseline model glm
m0.lrm = lrm(really ~ 1, data = reallywsc, x = T, y = T) # baseline model lrm
# inspect results
summary(m0.glm)
```

Now, we load packages for mixed-effects modelling and create a mixed-effects base-line model.

```{r adjampnze_3_19, echo=T, eval = T, message=FALSE, warning=FALSE}
# load libraries
library(lme4)
library(car)
# create model with a random intercept for token
m0.glmer = glmer(really ~ (1|Adjective), data = reallywsc, family = binomial, 
                  control=glmerControl(optimizer="bobyqa"))
```

Now, check if including the random effect is permitted by comparing the aic from the glm to aic from the glmer model.

```{r adjampnze_3_20, echo=T, eval = T, message=FALSE, warning=FALSE}
aic.glmer <- AIC(logLik(m0.glmer))
aic.glm <- AIC(logLik(m0.glm))
aic.glmer; aic.glm
```

The AIC of the glmer object is smaller which shows that including the random intercepts is justified. In addition, we test if including the random intercepts is justified statistically using a likelihood ratio test.

```{r adjampnze_3_21, echo=T, eval = T, message=FALSE, warning=FALSE}
# test random effects
null.id = -2 * logLik(m0.glm) + 2 * logLik(m0.glmer)
pchisq(as.numeric(null.id), df=1, lower.tail=F) 
```

The mixed-effects model (m0.glmer) has a significantly better fit than the fixed effects model (m0.glm). We continue by inspecting the results of the mixed-effects baseline model.

```{r adjampnze_3_22, echo=T, eval = T, message=FALSE, warning=FALSE}
# inspect results
summary(m0.glmer)
```

Now, we continue with the model fitting. We use a step-wise step-up procedure with vif cutoffs of 5 for main effects and 30 for interactions. We start by adding Age.

```{r adjampnze_3_23, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age
ifelse(min(ftable(reallywsc$Age, reallywsc$really)) == 0, "not possible", "possible")
m1.glm <- update(m0.glm, .~.+Age)
m1.glmer <- update(m0.glmer, .~.+Age)
anova(m0.glmer, m1.glmer, test = "Chi") 
Anova(m1.glmer, type = "III", test = "Chi")
```

We retain Age because it is significant. We continue by adding Priming.

```{r adjampnze_3_24, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Priming
m2.glm <- update(m1.glm, .~.+Priming)
max(vif(m2.glm)[,1])                                             
m2.glmer <- update(m1.glmer, .~.+Priming)
anova(m2.glmer, m1.glmer, test = "Chi")
Anova(m2.glmer, type = "III", test = "Chi")
```

Although including Priming does not lead to substantial collinearity (vifs > 5) and we retain it in the model because it is  significant. We continue by adding Frequency.

```{r adjampnze_3_25, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Frequency
ifelse(min(ftable(reallywsc$Frequency, reallywsc$really)) == 0, "not possible", "possible")
m3.glm <- update(m2.glm, .~.+Frequency)
max(vif(m3.glm)[,1])                         
m3.glmer <- update(m2.glmer, .~.+Frequency)
anova(m3.glmer, m2.glmer, test = "Chi") 
```

Including Frequency does not lead to substantial collinearity (vifs > 5) but we do not retain it in the model because it is not significant. We continue by adding Gender.

```{r adjampnze_3_26, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Gender
ifelse(min(ftable(reallywsc$Gender, reallywsc$really)) == 0, "not possible", "possible")
m4.glm <- update(m2.glm, .~.+Gender)
max(vif(m4.glm)[,1])                                               
m4.glmer <- update(m2.glmer, .~.+Gender)
anova(m4.glmer, m2.glmer, test = "Chi") 
Anova(m4.glmer, type = "III", test = "Chi")
```

Including Gender does not lead to substantial collinearity (vifs > 5) and we  retain it in the model because it is significant. We continue by adding SemanticCategory.

```{r adjampnze_3_27, echo=T, eval = T, message=FALSE, warning=FALSE}
# add SemanticCategory
ifelse(min(ftable(reallywsc$SemanticCategory, reallywsc$really)) == 0, "not possible", "possible")
m5.glm <- update(m4.glm, .~.+SemanticCategory)
max(vif(m5.glm)[,1])                                              
m5.glmer <- update(m4.glmer, .~.+Gradability)
anova(m5.glmer, m4.glmer, test = "Chi")   
```

Including SemanticCategory does not lead to substantial collinearity (vifs > 5) but we do not retain it in the model because it is not significant. We continue by adding Ethnicity.

```{r adjampnze_3_28, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Ethnicity
m6.glm <- update(m4.glm, .~.+Ethnicity)
max(vif(m6.glm)[,1])                                         
m6.glmer <- update(m4.glmer, .~.+Ethnicity)
anova(m6.glmer, m4.glmer, test = "Chi")  
Anova(m6.glmer, type = "III", test = "Chi")
```

Including Ethnicity does not lead to substantial collinearity (vifs > 5) and we  retain it in the model because it is significant. We continue by adding Emotionality.

```{r adjampnze_3_29, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Emotionality
ifelse(min(ftable(reallywsc$Emotionality, reallywsc$really)) == 0, "not possible", "possible")
m7.glm <- update(m6.glm, .~.+Emotionality)
max(vif(m7.glm)[,1])                                        
m7.glmer <- update(m6.glmer, .~.+Emotionality)
anova(m7.glmer, m6.glmer, test = "Chi")       
```

Including Ethnicity does not lead to substantial collinearity (vifs > 5) but we  do not retain it in the model because it is not significant. We continue with adding the two-way interactions. We start by inspecting the possible two-way interactions.

```{r adjampnze_3_30, echo=T, eval = T, message=FALSE, warning=FALSE}
# find all 2-way interactions
library(utils)
vars <- c("Age", "Priming", "Frequency", "Gender", "SemanticCategory", 
          "Ethnicity",  "Emotionality")
intac <- t(combn(vars, 2))
intac
```

We continue by adding the interactions in a step-wise step-up manner. The cutoff for collienarity is a variance inflation factor of 30 as we expect the variable that are involved in interactions to correlate with the interaction itself and thus are more leniant comapred with main effects. We start by adding the interaction between Age and Priming.

```{r adjampnze_3_31, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age * Priming
ifelse(min(ftable(reallywsc$Age, reallywsc$Priming, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Age and Priming is not possible due to incomplete information. We continue by adding the interaction between Age and Frequency.

```{r adjampnze_3_32, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age * Frequency
m8.glm <- update(m6.glm, .~.+Age * Frequency)
max(vif(m8.glm)[,1]) 
m8.glmer <- update(m6.glmer, .~.+Age * Frequency)
anova(m8.glmer, m6.glmer, test = "Chi")
```


Including the interaction between Age and Frequency does not lead to substantial collinearity (vifs < 30) but we do not retain it in the model because it is not significant. We continue by adding the interaction between Age and Gender.

```{r adjampnze_3_33, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age * Gender
ifelse(min(ftable(reallywsc$Age, reallywsc$Gender, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Age and Gender is not possible due to incomplete information and we thus continue by adding the interaction between Age and SemanticCategory.

```{r adjampnze_3_34, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age * SemanticCategory
ifelse(min(ftable(reallywsc$Age, reallywsc$SemanticCategory, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Age and SemanticCategory is not possible due to incomplete information and we thus continue by adding the interaction between Age and Ethnicity.

```{r adjampnze_3_35, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age * Ethnicity
ifelse(min(ftable(reallywsc$Age, reallywsc$Ethnicity, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Age and Ethnicity is not possible due to incomplete information and we thus continue by adding the interaction between Age and Emotionality.

```{r adjampnze_3_36, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Age * Emotionality
ifelse(min(ftable(reallywsc$Age, reallywsc$Emotionality, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Age and Emotionality is not possible due to incomplete information and we thus continue by adding the interaction between Priming and Frequency.

```{r adjampnze_3_37, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Priming * Frequency
m9.glm <- update(m6.glm, .~.+Priming * Frequency)
max(vif(m9.glm)[,1])                                            
m9.glmer <- update(m6.glmer, .~.+Priming * Frequency)
anova(m9.glmer, m6.glmer, test = "Chi")
```

Including the interaction between Priming and Frequency does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with adding the interaction between Priming and Gender.

```{r adjampnze_3_38, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Priming * Gender
ifelse(min(ftable(reallywsc$Priming, reallywsc$Gender, reallywsc$really)) == 0, "not possible", "possible") 
m10.glm <- update(m6.glm, .~.+Priming * Gender)
max(vif(m10.glm)[,1])
m10.glmer <- update(m6.glmer, .~.+Priming * Gender)
anova(m10.glmer, m6.glmer, test = "Chi")
Anova(m10.glmer, type = "III", test = "Chi")
```

Including the interaction between Priming and Frequency does not lead to substantial collinearity (vifs < 30) but we do not retain it in the model because it is not significant. We continue with adding the interaction between Priming and SemanticCategory.

```{r adjampnze_3_39, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Priming * SemanticCategory
ifelse(min(ftable(reallywsc$Priming, reallywsc$SemanticCategory, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Priming and SemanticCategory is not possible due to incomplete information and we thus continue by adding the interaction between Priming and Ethnicity.

```{r adjampnze_3_40, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Priming * Ethnicity
ifelse(min(ftable(reallywsc$Priming, reallywsc$Ethnicity, reallywsc$really)) == 0, "not possible", "possible") 
m11.glm <- update(m6.glm, .~.+Priming * Ethnicity)
max(vif(m11.glm)[,1])
m11.glmer <- update(m6.glmer, .~.+Priming * Ethnicity)
anova(m11.glmer, m6.glmer, test = "Chi")
```

Including the interaction between Priming and Ethnicity does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with adding the interaction between Priming and SemanticCategory.

```{r adjampnze_3_41, echo=T, eval = T, message=FALSE, warning=FALSE}
ifelse(min(ftable(reallywsc$Priming, reallywsc$SemanticCategory, reallywsc$really)) == 0, "not possible", "possible") 
```

Including the interaction between Priming and Ethnicity is not possible due to incomplete information and we thus continue by adding the interaction between Priming and Emotionality.

```{r adjampnze_3_42, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Priming * Emotionality
ifelse(min(ftable(reallywsc$Priming, reallywsc$Emotionality, reallywsc$really)) == 0, "not possible", "possible")
m12.glm <- update(m6.glm, .~.+Priming * Emotionality)
max(vif(m12.glm)[,1])
m12.glmer <- update(m6.glmer, .~.+Priming * Emotionality)
anova(m12.glmer, m6.glmer, test = "Chi")
```

Including the interaction between Priming and Emotionality  does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with adding the interaction between Frequency and Gender.

```{r adjampnze_3_43, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Frequency * Gender
m13.glm <- update(m6.glm, .~.+Frequency * Gender)
max(vif(m13.glm)[,1])
m13.glmer <- update(m6.glmer, .~.+Frequency * Gender)
anova(m13.glmer, m6.glmer, test = "Chi")
```

Including the interaction between Frequency and Gender does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with adding the interaction between Frequency and SemanticCategory.

```{r adjampnze_3_44, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Frequency * SemanticCategory
m14.glm <- update(m6.glm, .~.+Frequency * SemanticCategory)
max(vif(m14.glm)[,1])                                           
```

Including the interaction between Frequency and SemanticCategory leads to unacceptable collinearity (vifs > 100) and we thus do not retain it in the model. We continue with adding the interaction between Frequency and Ethnicity.

```{r adjampnze_3_45, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Frequency * Ethnicity
m15.glm <- update(m6.glm, .~.+Frequency * Ethnicity)
max(vif(m15.glm)[,1])                                         
m15.glmer <- update(m6.glmer, .~.+Frequency * Ethnicity)
anova(m15.glmer, m6.glmer, test = "Chi") 
```

Including the interaction between Frequency and Ethnicity does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with adding the interaction between Frequency and Emotionality

```{r adjampnze_3_46, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Frequency * Emotionality 
m16.glm <- update(m6.glm, .~.+Frequency * Emotionality)
max(vif(m16.glm)[,1])                                        
m16.glmer <- update(m6.glmer, .~.+Frequency * Emotionality)
anova(m16.glmer, m6.glmer, test = "Chi")
```

Including the interaction between Frequency and Emotionality does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with adding the interaction between Gender and SemanticCategory.

```{r adjampnze_3_47, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Gender * SemanticCategory
ifelse(min(ftable(reallywsc$Gender, reallywsc$SemanticCategory, reallywsc$really)) == 0, "not possible", "possible")
m17.glm <- update(m6.glm, .~.+Gender * SemanticCategory)
max(vif(m17.glm)[,1])                                        
```

Including the interaction between Gender and SemanticCategory leads to unacceptable collinearity (vifs > 30) and we thus do not retain it in the model. We continue with adding the interaction between Gender and SemanticCategory.

```{r adjampnze_3_48, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Gender * Ethnicity
ifelse(min(ftable(reallywsc$Gender, reallywsc$Ethnicity, reallywsc$really)) == 0, "not possible", "possible")
m18.glm <- update(m6.glm, .~.+Gender * Ethnicity)
max(vif(m18.glm)[,1])  
```

Including the interaction between Gender and Ethnicity leads to unacceptable collinearity (vifs > 30) and we thus do not retain it in the model. We continue with adding the interaction between Gender and Emotionality.

```{r adjampnze_3_49, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Gender * Emotionality
ifelse(min(ftable(reallywsc$Gender, reallywsc$Emotionality, reallywsc$really)) == 0, "not possible", "possible")
m19.glm <- update(m6.glm, .~.+Gender * Emotionality)
max(vif(m19.glm)[,1])
m19.glmer <- update(m6.glmer, .~.+Gender * Emotionality)
anova(m19.glmer, m6.glmer, test = "Chi")
```

Including the interaction between Gender and Emotionality does not lead to substantial collinearity (vifs < 30) but we  do not retain it in the model because it is not significant. We continue with  adding the interaction between Gender and Emotionality.

```{r adjampnze_3_50, echo=T, eval = T, message=FALSE, warning=FALSE}
# add SemanticCategory * Ethnicity
ifelse(min(ftable(reallywsc$SemanticCategory, reallywsc$Ethnicity, reallywsc$really)) == 0, "not possible", "possible")
```

Including the interaction between SemanticCategory and Ethnicity is not possible due to incomplete information and we thus continue by adding the interaction between SemanticCategory and Emotionality.

```{r adjampnze_3_51, echo=T, eval = T, message=FALSE, warning=FALSE}
# add SemanticCategory * Emotionality
ifelse(min(ftable(reallywsc$SemanticCategory, reallywsc$Emotionality, reallywsc$really)) == 0, "not possible", "possible")
```

Including the interaction between SemanticCategory and Emotionality is not possible due to incomplete information and we thus continue by adding the interaction between Ethnicity and Emotionality.

```{r adjampnze_3_52, echo=T, eval = T, message=FALSE, warning=FALSE}
# add Ethnicity * Emotionality
ifelse(min(ftable(reallywsc$Ethnicity, reallywsc$Emotionality, reallywsc$really)) == 0, "not possible", "possible")
m20.glm <- update(m6.glm, .~.+Ethnicity * Emotionality)
max(vif(m20.glm)[,1])
```

Including the interaction between SemanticCategory and Emotionality leads to unacceptable collinearity (vifs > 30) and we thus do not retain it in the model.

We continue with adding the two-way interactions. We start by inspecting the possible two-way interactions.

```{r adjampnze_3_53, echo=T, eval = T, message=FALSE, warning=FALSE}
# find all 2-way interactions
library(utils)
vars <- c("Age", "Priming", "Frequency", "Gender", "SemanticCategory", 
          "Ethnicity",  "Emotionality")
intac <- t(combn(vars, 3))
intac
```

Check which of these interactions can be tested.

```{r adjampnze_3_54, echo=T, eval = T, message=FALSE, warning=FALSE}
AgePrimingFrequency <- ifelse(min(ftable(reallywsc$Age, reallywsc$Priming, reallywsc$Frequency)) == 0, "not possible", "possible")
AgePrimingGender <- ifelse(min(ftable(reallywsc$Age, reallywsc$Priming, reallywsc$Gender)) == 0, "not possible", "possible")
AgePrimingSemanticCategory <- ifelse(min(ftable(reallywsc$Age, reallywsc$Priming, reallywsc$SemanticCategory)) == 0, "not possible", "possible")
AgePrimingEthnicity <- ifelse(min(ftable(reallywsc$Age, reallywsc$Priming, reallywsc$Ethnicity)) == 0, "not possible", "possible")
AgePrimingEmotionality <- ifelse(min(ftable(reallywsc$Age, 
reallywsc$Priming, reallywsc$Emotionality)) == 0, "not possible", "possible")
AgeFrequencyGender <- ifelse(min(ftable(reallywsc$Age, reallywsc$Frequency, reallywsc$Gender)) == 0, "not possible", "possible")
AgeFrequencySemanticCategory <- ifelse(min(ftable(reallywsc$Age, reallywsc$Frequency, reallywsc$SemanticCategory)) == 0, "not possible", "possible")
AgeFrequencyEthnicity <- ifelse(min(ftable(reallywsc$Age, reallywsc$Frequency, reallywsc$Ethnicity)) == 0, "not possible", "possible")
AgeFrequencyEmotionality <- ifelse(min(ftable(reallywsc$Age, reallywsc$Frequency, reallywsc$Emotionality)) == 0, "not possible", "possible")
AgeGenderSemanticCategory <- ifelse(min(ftable(reallywsc$Age, reallywsc$Gender, reallywsc$SemanticCategory)) == 0, "not possible", "possible")
AgeGenderEthnicity <- ifelse(min(ftable(reallywsc$Age, reallywsc$Gender, reallywsc$Ethnicity)) == 0, "not possible", "possible")
AgeGenderEmotionality <- ifelse(min(ftable(reallywsc$Age, reallywsc$Gender, reallywsc$Emotionality)) == 0, "not possible", "possible")
AgeSemanticCategoryEthnicity <- ifelse(min(ftable(reallywsc$Age, reallywsc$SemanticCategory, reallywsc$Ethnicity)) == 0, "not possible", "possible")
AgeSemanticCategoryEmotionality <- ifelse(min(ftable(reallywsc$Age, reallywsc$SemanticCategory, reallywsc$Emotionality)) == 0, "not possible", "possible")
AgeEthnicityEmotionality <- ifelse(min(ftable(reallywsc$Age, reallywsc$Ethnicity, reallywsc$Emotionality)) == 0, "not possible", "possible")
PrimingFrequencyGender <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Frequency, reallywsc$Gender)) == 0, "not possible", "possible")
PrimingFrequencySemanticCategory <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Frequency, reallywsc$SemanticCategory)) == 0, "not possible", "possible")
PrimingFrequencyEthnicity <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Frequency, reallywsc$Ethnicity)) == 0, "not possible", "possible")
PrimingFrequencyEmotionality <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Frequency, reallywsc$Emotionality)) == 0, "not possible", "possible")
PrimingGenderSemanticCategory <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Gender, reallywsc$SemanticCategory)) == 0, "not possible", "possible")
PrimingGenderEthnicity <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Gender, reallywsc$Ethnicity)) == 0, "not possible", "possible")
PrimingGenderEmotionality <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Gender, reallywsc$Emotionality)) == 0, "not possible", "possible")
PrimingSemanticCategoryEthnicity <- ifelse(min(ftable(reallywsc$Priming, reallywsc$SemanticCategory, reallywsc$Ethnicity)) == 0, "not possible", "possible")
PrimingSemanticCategoryEmotionality <- ifelse(min(ftable(reallywsc$Priming, reallywsc$SemanticCategory, reallywsc$Emotionality)) == 0, "not possible", "possible")
PrimingEthnicityEmotionality <- ifelse(min(ftable(reallywsc$Priming, reallywsc$Ethnicity, reallywsc$Emotionality)) == 0, "not possible", "possible")
FrequencyGenderSemanticCategory <- ifelse(min(ftable(reallywsc$Frequency, reallywsc$Gender, reallywsc$SemanticCategory)) == 0, "not possible", "possible")
FrequencyGenderEthnicity <- ifelse(min(ftable(reallywsc$Frequency, reallywsc$Gender, reallywsc$Ethnicity)) == 0, "not possible", "possible")
FrequencyGenderEmotionality <- ifelse(min(ftable(reallywsc$Frequency, reallywsc$Gender, reallywsc$Emotionality)) == 0, "not possible", "possible")
FrequencySemanticCategoryEthnicity <- ifelse(min(ftable(reallywsc$Frequency, reallywsc$SemanticCategory, reallywsc$Ethnicity)) == 0, "not possible", "possible")
FrequencySemanticCategoryEmotionality <- ifelse(min(ftable(reallywsc$Frequency, reallywsc$SemanticCategory, reallywsc$Emotionality)) == 0, "not possible", "possible")
FrequencyEthnicityEmotionality <- ifelse(min(ftable(reallywsc$Frequency, reallywsc$Ethnicity, reallywsc$Emotionality)) == 0, "not possible", "possible")
GenderSemanticCategoryEthnicity <- ifelse(min(ftable(reallywsc$Gender, reallywsc$SemanticCategory, reallywsc$Ethnicity)) == 0, "not possible", "possible")
GenderSemanticCategoryEmotionality <- ifelse(min(ftable(reallywsc$Gender, reallywsc$SemanticCategory, reallywsc$Emotionality)) == 0, "not possible", "possible")
GenderEthnicityEmotionality <- ifelse(min(ftable(reallywsc$Gender, reallywsc$Ethnicity, reallywsc$Emotionality)) == 0, "not possible", "possible")
SemanticCategoryEthnicityEmotionality <- ifelse(min(ftable(reallywsc$SemanticCategory, reallywsc$Ethnicity, reallywsc$Emotionality)) == 0, "not possible", "possible")
```

```{r adjampnze_3_55, echo=T, eval = T, message=FALSE, warning=FALSE}
AgePrimingFrequency
AgePrimingGender
AgePrimingSemanticCategory
AgePrimingEthnicity
AgePrimingEmotionality
AgeFrequencyGender
AgeFrequencySemanticCategory
AgeFrequencyEthnicity
AgeFrequencyEmotionality
AgeGenderSemanticCategory
AgeGenderEthnicity
AgeGenderEmotionality
AgeSemanticCategoryEthnicity
AgeSemanticCategoryEmotionality
AgeEthnicityEmotionality
PrimingFrequencyGender
PrimingFrequencySemanticCategory
PrimingFrequencyEthnicity
PrimingFrequencyEmotionality
PrimingGenderSemanticCategory
PrimingGenderEthnicity
PrimingGenderEmotionality
PrimingSemanticCategoryEthnicity
PrimingSemanticCategoryEmotionality
PrimingEthnicityEmotionality
FrequencyGenderSemanticCategory
FrequencyGenderEthnicity
FrequencyGenderEmotionality
FrequencySemanticCategoryEthnicity
FrequencySemanticCategoryEmotionality
FrequencyEthnicityEmotionality
GenderSemanticCategoryEthnicity
GenderSemanticCategoryEmotionality
GenderEthnicityEmotionality
SemanticCategoryEthnicityEmotionality
```

```{r adjampnze_3_56, echo=T, eval = T, message=FALSE, warning=FALSE}


# add Emotionality * SemanticCategory 
m23.glm <- update(m3.glm, .~.+Emotionality * SemanticCategory)
max(vif(m23.glm)[,1])                                               
# Error in vif.default(m23.glm) : there are aliased coefficients in the model

# add Emotionality * Gradability 
m24.glm <- update(m3.glm, .~.+Emotionality * Gradability)
max(vif(m24.glm)[,1])                                               # VIFs ok
m24.glmer <- update(m3.glmer, .~.+Emotionality * Gradability)
anova(m24.glmer, m3.glmer, test = "Chi")                            # SIG! (p = 0.004597 **)
Anova(m24.glmer, type = "III", test = "Chi")                        # SIG! (p = 0.0089823 **)
bic <- anova(m24.glmer, m3.glmer, test = "Chi")
ifelse(bic$BIC[2]-bic$BIC[1] < 0, "ok", "BIC inflation!")           # BIC inflation!
# return to model m3.glmer

# add Emotionality * Priming 
m25.glm <- update(m3.glm, .~.+Emotionality * Priming)
max(vif(m25.glm)[,1])                                               # high VIFs
m25.glmer <- update(m3.glmer, .~.+Emotionality * Priming)
anova(m25.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.9929)

# add Emotionality * L1 
m26.glm <- update(m3.glm, .~.+Emotionality * L1)
max(vif(m26.glm)[,1])                                               # high VIFs 
m26.glmer <- update(m3.glmer, .~.+Emotionality * L1)
anova(m26.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.06568 .)
Anova(m26.glmer, type = "III", test = "Chi")                        # not sig (p = 0.1294207)

# add Ethnicity * SemanticCategory 
m27.glm <- update(m3.glm, .~.+Ethnicity * SemanticCategory)
max(vif(m27.glm)[,1])                                               # high VIFs 
# Error in vif.default(m27.glm) : there are aliased coefficients in the model

# add Ethnicity * Gradability 
m28.glm <- update(m3.glm, .~.+Ethnicity * Gradability)
max(vif(m28.glm)[,1])                                               # VIFs ok
m28.glmer <- update(m3.glmer, .~.+Ethnicity * Gradability)
anova(m28.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2035)

# add Ethnicity * Priming  
m29.glm <- update(m3.glm, .~.+Ethnicity * Priming)
max(vif(m29.glm)[,1])                                               # VIFs ok
m29.glmer <- update(m3.glmer, .~.+Ethnicity * Priming)
anova(m29.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.9995)

# add Ethnicity * L1   
m30.glm <- update(m3.glm, .~.+Ethnicity * L1)
max(vif(m30.glm)[,1])                                               # VIFs ok
m30.glmer <- update(m3.glmer, .~.+Ethnicity * L1)
anova(m30.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2482)

# add SemanticCategory * Gradability   
m31.glm <- update(m3.glm, .~.+SemanticCategory * Gradability)
max(vif(m31.glm)[,1])                                               # VIFs unacceptable

# add SemanticCategory * Priming   
m32.glm <- update(m3.glm, .~.+SemanticCategory * Priming)
max(vif(m32.glm)[,1])                                               # VIFs unacceptable

# add SemanticCategory * L1   
m33.glm <- update(m3.glm, .~.+SemanticCategory * L1)
max(vif(m33.glm)[,1])                                               # VIFs unacceptable
# Error in vif.default(m33.glm) : there are aliased coefficients in the model

# add Gradability * Priming  
m34.glm <- update(m3.glm, .~.+Gradability * Priming)
max(vif(m34.glm)[,1])                                               # VIFs ok
m34.glmer <- update(m3.glmer, .~.+Gradability * Priming)
anova(m34.glmer, m3.glmer, test = "Chi")                            # SIG! (p = 0.04327 *)
Anova(m34.glmer, type = "III", test = "Chi")                        # SIG! (p = 0.032951 *)
bic <- anova(m34.glmer, m3.glmer, test = "Chi")
ifelse(bic$BIC[2]-bic$BIC[1] < 0, "ok", "BIC inflation!")           # BIC inflation!
# return to model m3.glmer

# add Gradability * L1  
m35.glm <- update(m3.glm, .~.+Gradability * L1)
max(vif(m35.glm)[,1])                                               # VIFs ok
m35.glmer <- update(m3.glmer, .~.+Gradability * L1)
anova(m35.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.06003 .)
Anova(m35.glmer, type = "III", test = "Chi")                        # not sig (p = 0.278465)

# add Priming * L1  
m36.glm <- update(m3.glm, .~.+Priming * L1)
max(vif(m36.glm)[,1])                                               # VIFs ok
m36.glmer <- update(m3.glmer, .~.+Priming * L1)
anova(m36.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2725)

#########################################
# calculate power
# load package
library(simr)
# restructure data
preallywsc <- reallywsc %>%
  dplyr::select(Age, Emotionality, Adjective, really) %>%
  dplyr::mutate(other = ifelse(really == "really", 0, 1)) %>%
  dplyr::mutate(really = ifelse(really == "really", 1, 0)) %>%
  dplyr::group_by(Age, Emotionality, Adjective) %>%
  dplyr::summarise(really = sum(really), other = sum(other))
# redo model
gm1 <- glmer(cbind(really, other) ~ Age + Emotionality + (1 | Adjective), data=preallywsc,
             family=binomial)
# perform likelihood ratio test
doTest(gm1, fixed("Age", "lr"))

# set seed for replicability
set.seed(2019121201)
# calculate power for Age
powerSim(m3.glmer, fixed("Age", "lr"), nsim=100)

# set seed for replicability
set.seed(2019121202)
# calculate power for Emotionality
powerSim(gm1, fixed("Emotionality", "lr"), nsim=100)

# check power curve
#pc <- powerCurve(gm1)
# inspect plot
#plot(pc)

#########################################
# load function for regression table summary
source("D:\\R/meblr.summary.R")
# set up summary table
meblrm_ampwsc <- meblrm.summary(m0.glm, m3.glm, m0.glmer, m3.glmer, reallywsc$really) #
meblrm_ampwsc

# save results to disc
write.table(meblrm_ampwsc, "datatables/meblrm_ampwsc.txt", sep="\t")

# load function
library(car)
meblrm_ampwsc_Anova <- Anova(m3.glmer, type = "III", test = "Chi")
meblrm_ampwsc_Anova

# save results to disc
write.table(meblrm_ampwsc_Anova, "datatables/meblrm_ampwsc_Anova.txt", sep="\t")

effectage <- anova(m1.glmer, m0.glmer, test = "Chi")

effectemotionality <- anova(m3.glmer, m1.glmer, test = "Chi")

# use customized model comparison function
# create comparireallyns
m1.m0 <- anova(m1.glmer, m0.glmer, test = "Chi")                            # SIG! (p = 0.00000000000000022 ***)
m2.m1 <- anova(m2.glmer, m1.glmer, test = "Chi")                            # not sig (p=0.618)
m3.m1 <- anova(m3.glmer, m1.glmer, test = "Chi")                            # SIG! (p = 0.00004315 ***)
m4.m3 <- anova(m4.glmer, m3.glmer, test = "Chi")                            # not sig (p=0.9503)
m5.m3 <- anova(m5.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.06859 .)
m6.m3 <- anova(m6.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.06859 .)
m7.m3 <- anova(m7.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.8786)
m8.m3 <- anova(m8.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.09292 .)
m9.m3 <- anova(m9.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.1792)
m13.m3 <- anova(m13.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.3312)
m14.m3 <- anova(m14.glmer, m3.glmer, test = "Chi")                            # SIG! (p = 0.01175 *)
m15.m3 <- anova(m15.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2736)
m17.m3 <- anova(m17.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.7228)
m19.m3 <- anova(m19.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.1545)
m20.m3 <- anova(m20.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.1897)
m21.m3 <- anova(m21.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.3614)
m24.m3 <- anova(m24.glmer, m3.glmer, test = "Chi")                            # SIG! (p = 0.004597 **)
m25.m3 <- anova(m25.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.9929)
m26.m3 <- anova(m26.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.06568 .)
m28.m3 <- anova(m28.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2035)
m29.m3 <- anova(m29.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.9995)
m30.m3 <- anova(m30.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2482)
m34.m3 <- anova(m34.glmer, m3.glmer, test = "Chi")                            # SIG! (p = 0.04327 *)
m35.m3 <- anova(m35.glmer, m3.glmer, test = "Chi")                            # mar sig (p = 0.06003 .)
m36.m3 <- anova(m36.glmer, m3.glmer, test = "Chi")                            # not sig (p = 0.2725)

# create a list of the model comparireallyns
mdlcmp <- list(m1.m0, m2.m1, m3.m1, m4.m3, m5.m3, m6.m3, m7.m3, m8.m3, 
               m9.m3, m13.m3, m14.m3, m15.m3, m17.m3, m19.m3, m20.m3, 
               m21.m3, m24.m3, m25.m3, m26.m3, m28.m3, m29.m3, m30.m3, 
               m34.m3, m35.m3, m36.m3)
# load function
source("D:\\R/ModelFittingSummarySWSU.R") # for Mixed Effects Model fitting (step-wise step-up): Binary Logistic Mixed Effects Models
# apply function
mdl.cmp.glmersc.swsu.dm <- mdl.fttng.swsu(mdlcmp)
# inspect output
mdl.cmp.glmersc.swsu.dm

write.table(mdl.cmp.glmersc.swsu.dm, "datatables/mdl_cmp_glmersc_swsu_reallywsc.txt", sep="\t")
###########################################################
# Post-hoc analysis
library (multcomp)
summary(glht(m3.glmer, mcp(Age="Tukey")))

summary(glht(m3.glmer, mcp(Emotionality="Tukey")))

################################################################
#                 IMPORTANT OBJECTS
################################################################
# inspect really important objects
head(reallywsc)

# glmer
effectage

effectemotionality

meblrm_ampwsc

meblrm_ampwsc_Anova

###############################################################
# predict probs of nativelike for effects
reallywsc$PredictedFrequency <- predict(m3.glmer, reallywsc, type="response")
summary(reallywsc$PredictedFrequency)

# create response variable
reallywsc$PredictedResponse <- ifelse(reallywsc$PredictedFrequency > .5, "really", "other")
summary(reallywsc$PredictedResponse)

# load library
library(caret)
# create confusion matrix
confusionMatrix(as.factor(reallywsc$PredictedResponse), as.factor(reallywsc$really))

# prepare plot data (pd) 
pd <- reallywsc

# effect emotionality
p5 <- ggplot(pd, aes(x = Emotionality, y = PredictedFrequency)) +
  stat_summary(fun.y = mean, geom = "point") +          
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) + 
  coord_cartesian(ylim = c(0, 1)) +
  theme_set(theme_bw(base_size = 20)) +
  #  theme(legend.position="none") +
  labs(x = "Emotionality", y = "Predicted probability\nof really") +
  ggsave(file = paste(imageDirectory,"PredictedEmotionality.png",sep="/"), 
       height = 5,  width = 7,  dpi = 320)
p5

# convert Age column
Agelbs <- names(table(pd$Age))
pd$Age <- ifelse(pd$Age == "16-19", 6,
                 ifelse(pd$Age == "20-29", 5,
                        ifelse(pd$Age == "30-39", 4, 
                               ifelse(pd$Age == "40-49", 3, 
                                      ifelse(pd$Age == "50-59", 2, 
                                             ifelse(pd$Age == "60+", 1, pd$Age))))))
pd$Age<- as.numeric(pd$Age)
# effect age
p6 <- ggplot(pd, aes(x = Age, y = PredictedFrequency)) +
  geom_smooth(aes(y = PredictedFrequency, x = Age), 
              colour="black", size=1, se = T, method = "loess") +
  coord_cartesian(ylim = c(0, 1)) +
  theme_set(theme_light(base_size = 15)) +
  #  theme(legend.position="none") +
  labs(x = "Frequency of adj. type", y = "Predicted probability\nof really") +
  scale_x_continuous(name = "Age",
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels=rev(Agelbs))
ggsave(file = paste(imageDirectory,"PredictedAge.png",sep="/"), 
       height = 5,  width = 5,  dpi = 320)
p6

library(effects)
png("images/effectsfinalmodel.png",  width = 960, height = 480) 
plot(allEffects(m3.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black",
                  lty = 1,
                  confint=list(style="bars",
                               col = "grey80")), 
     ylab = "Prob (really)")
dev.off()

randomtb <- ranef(m3.glmer)
rndmadj <- as.vector(unlist(randomtb$`Adjective`))
adj <- as.vector(unlist(rownames(randomtb$`Adjective`)))
rndmadjtb <- data.frame(adj, rndmadj)
colnames(rndmadjtb) <- c("Adjective", "Intercept")
rndmadjtb <- rndmadjtb[order(rndmadjtb$Intercept, decreasing = T),]
rndmadjtb

p7 <- ggplot(rndmadjtb, aes(Adjective, Intercept)) +
  geom_point(aes(reorder(Adjective, -Intercept, fun = Intercept), y=Intercept)) +
  coord_cartesian(ylim = c(-1.5, 1.5)) +
  theme_set(theme_bw(base_size = 15)) +
  theme(legend.position="none", axis.text.x = element_text(size=15, angle=90)) +
  labs(x = "Adjective type", y = "Adjustment to Intercept")
ggsave(file = paste(imageDirectory,"RanAdjective.png",sep="/"), 
       height = 5,  width = 10,  dpi = 320)
# activate (remove #) to show
p7

###############################################################
write.table(reallywsc, "datatables/reallywsc.txt", row.names= F, sep = "\t")
```

We have reached the end of the analysis.
